/* Реализовать программу-калькулятор с возможностью выполнения арифметических действий (+, -), унарный и бинарный вариант. 
У пользователя запрашивается выражение, например, "-123.5 + 4 - 456+56", программа должна решить выражение. 
Для разбора входной строки использовать функцию strok. */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

int main() {
    char input[256];  // Буфер для ввода выражения
    printf("Enter an expression (for example, \"-123.5 + 4 - 456 + 56\"): ");
    fgets(input, sizeof(input), stdin);  // Читаем ввод пользователя

    double result = 0;  // Итоговый результат
    char *token = strtok(input, " +-");  // Разбиваем строку на токены по пробелам и знакам +/-
    int sign = 1;  // Текущий знак (+1 или -1)

    // Обрабатываем первый токен (может быть унарным минусом)
    if (token != NULL) {
        // Если первый символ ввода был '-', это унарный минус
        if (input[0] == '-') {
            sign = -1;
        }
        result = sign * atof(token);  // Преобразуем строку в число и учитываем знак
        token = strtok(NULL, " +-");  // Берем следующий токен
    }

    // Обрабатываем остальные токены
    while (token != NULL) {
        // Определяем знак операции перед токеном
        char *prev_token_end = token - 2;  // Указатель на символ перед токеном
        if (prev_token_end >= input && *prev_token_end == '-') {
            sign = -1;
        } else {
            sign = 1;
        }

        result += sign * atof(token);  // Добавляем/вычитаем число к результату
        token = strtok(NULL, " +-");   // Берем следующий токен
    }

    printf("Result: %.2f\n", result);  // Выводим результат с 2 знаками после запятой
    return 0;
}
